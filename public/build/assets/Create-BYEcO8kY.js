import{s as B,T as F,r as c,x as O,C as $,c as G,w as p,a as t,b as m,h as X,d as u,e as h,i as v,n as w,u as r,v as y,o as n,t as f,F as q,g as H,k as E,f as _,N as Q,p as Y}from"./app--chFm45-.js";import{S as W,Y as z,h as N,_ as J,V as K,b as S}from"./browser-C9Az4pkk.js";import{_ as Z}from"./AppLayout-CTdDzjd6.js";import"./ResponsiveNavLink-JdP7bwID.js";const ee={class:"min-h-screen bg-gray-100"},te={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},oe={class:"bg-white shadow rounded-lg overflow-hidden"},se={class:"px-6 py-5"},re={class:"grid grid-cols-6 gap-6"},ae={class:"col-span-6 sm:col-span-2"},ne={class:"mt-1 flex rounded-md shadow-sm"},le={class:"relative flex-grow"},ie={key:0,class:"mt-1 text-sm text-red-600"},de={class:"px-6 pb-5"},ce={class:"grid grid-cols-6 gap-6"},ue={class:"col-span-6 sm:col-span-2"},me={key:0,class:"mt-1 text-sm text-red-600"},pe={class:"col-span-6 sm:col-span-2"},ge={key:0,class:"mt-1 text-sm text-red-600"},fe={class:"col-span-6 sm:col-span-2"},be={key:0,class:"mt-1 text-sm text-red-600"},he={class:"col-span-6 mt-6"},ve={key:0,class:"mt-1 text-sm text-red-600"},ye={class:"col-span-6 sm:col-span-2 mt-6"},xe={class:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md"},we={class:"space-y-1 text-center"},ke={class:"flex text-sm text-gray-600"},_e={for:"vehicle_images",class:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500"},Ce={key:0,class:"mt-2"},Te={class:"text-sm text-gray-700 truncate max-w-xs"},Pe=["onClick"],Le={class:"px-6 py-3 bg-gray-50 text-right border-t border-gray-200"},De=["disabled"],Ee={key:0},Ne={key:1},Se={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ue={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6"},je={class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"},Ie={class:"mt-3 text-center sm:mt-5"},Ve={class:"mt-4"},Me={class:"text-sm text-gray-500"},Re={class:"mt-5 sm:mt-6 grid grid-cols-2 gap-3"},qe={__name:"Create",props:{errors:Object},setup(Ae){const{proxy:Be}=B(),s=F({customer_phone:"",vehicle_make:"",vehicle_model:"",license_plate:"",notes:"",check_in_latitude:null,check_in_longitude:null,images:[]}),l=c([]),i=c("Getting your location..."),x=c(!1),k=c(!1),C=c(null);c(null);const T=c(""),g=c(""),b=c(""),U=()=>{const o=b.value.replace(/\D/g,"").substring(0,10);b.value=o,o.length>=9?s.customer_phone="966"+(o.startsWith("0")?o.substring(1):o):s.customer_phone=""};c(!1);const j=()=>{k.value=!1,T.value="",setTimeout(()=>{Q.get(route("tenant.dashboard"))},200)},I=o=>{const d=Array.from(o.target.files).filter(a=>a.type.startsWith("image/")).slice(0,5-l.value.length);l.value=[...l.value,...d],s.images=l.value},V=o=>{l.value.splice(o,1),s.images=[...l.value]},P=async()=>{if(!navigator.geolocation){i.value="Geolocation is not supported by your browser";return}try{i.value="Getting your location...";const o=await new Promise((e,d)=>{navigator.geolocation.getCurrentPosition(e,d,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});s.check_in_latitude=o.coords.latitude,s.check_in_longitude=o.coords.longitude,x.value=!0,i.value="Location captured successfully"}catch(o){switch(console.error("Error getting location:",o),o.code){case o.PERMISSION_DENIED:i.value="Location access was denied. Please enable location services and refresh the page.";break;case o.POSITION_UNAVAILABLE:i.value="Location information is unavailable.";break;case o.TIMEOUT:i.value="The request to get user location timed out.";break;default:i.value="An unknown error occurred while getting location."}x.value=!1}},M=async()=>{if(console.log(s),!x.value){i.value="Getting your location...";try{if(await P(),!x.value){i.value="Location is required. Please enable location services and try again.";return}}catch{i.value="Error getting location. Please try again.";return}}try{if(l.value.length>0){const o=new FormData;Object.keys(s).forEach(e=>{e!=="images"&&s[e]!==null&&o.append(e,s[e])}),l.value.forEach((e,d)=>{o.append(`images[${d}]`,e)}),await s.post(route("tenant.tickets.store"),{data:o,forceFormData:!0,preserveScroll:!0,onSuccess:e=>{e.props.ticket&&L(e.props.ticket)},onError:e=>{console.log("Form errors:",e),s.errors=e}})}else await s.post(route("tenant.tickets.store"),{preserveScroll:!0,onSuccess:o=>{o.props.ticket&&L(o.props.ticket)},onError:o=>{console.log("Form errors:",o),s.errors=o}})}catch(o){console.error("Error submitting form:",o),s.errors={submit:["An error occurred while submitting the form."]}}},L=async o=>{try{g.value=o.ticket_number;const e=JSON.stringify({ticket_id:o.id,ticket_number:o.ticket_number,customer_name:o.customer_name,license_plate:o.license_plate});T.value=await S.toDataURL(e,{errorCorrectionLevel:"H",width:200,margin:1}),k.value=!0,await Y(),C.value&&await S.toCanvas(C.value,e,{errorCorrectionLevel:"H",width:200,margin:1})}catch(e){console.error("Error generating QR code:",e)}},R=()=>{const o=window.open("","_blank"),e=`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Print Ticket #${g.value}</title>
      <style>
        @media print {
          @page { margin: 0; }
          body { margin: 1.6cm; }
        }
        .ticket { 
          max-width: 300px; 
          margin: 0 auto; 
          text-align: center; 
          padding: 20px; 
          border: 1px solid #000; 
          border-radius: 5px;
        }
        .ticket h2 { margin: 0 0 10px 0; }
        .ticket p { margin: 5px 0; }
      </style>
    </head>
    <body>
      <div class="ticket">
        <h2>Valet Parking Ticket</h2>
        <p>Ticket #${g.value}</p>
        
        <p>${new Date().toLocaleString()}</p>
        <p>Please keep this ticket safe</p>
      </div>
      <script>
        window.onload = function() {
          window.print();
          window.onafterprint = function() {
            window.close();
          }
        };
      <\/script>
    </body>
    </html>
  `;o.document.open(),o.document.write(e),o.document.close()},A=()=>{const o=`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Ticket #${g.value}</title>
      <style>
        body { 
          font-family: Arial, sans-serif; 
          text-align: center;
          padding: 20px;
        }
        .ticket { 
          display: inline-block;
          padding: 20px;
          border: 1px solid #000;
          border-radius: 5px;
          text-align: center;
        }
        .ticket h2 { margin: 0 0 10px 0; }
        .ticket p { margin: 5px 0; }
      </style>
    </head>
    <body>
      <div class="ticket">
        <h2>Valet Parking Ticket</h2>
        <p>Ticket #${g.value}</p>
        <p>${new Date().toLocaleString()}</p>
        <p>Please keep this ticket safe</p>
      </div>
    </body>
    </html>
  `,e=new Blob([o],{type:"text/html"}),d=URL.createObjectURL(e),a=document.createElement("a");a.href=d,a.download=`ticket-${g.value}.`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(d)};return O(()=>{P()}),(o,e)=>{const d=$("CheckIcon");return n(),G(Z,null,{default:p(()=>[t("div",ee,[e[20]||(e[20]=t("div",{class:"bg-white shadow"},[t("div",{class:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center"},[t("h2",{class:"text-lg font-medium text-gray-900"},"Create New Ticket")])],-1)),t("div",te,[t("div",oe,[t("form",{id:"ticket-form",onSubmit:X(M,["prevent"]),enctype:"multipart/form-data"},[e[19]||(e[19]=t("div",{class:"px-6 py-5 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Customer Info")],-1)),t("div",se,[t("div",re,[t("div",ae,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Customer Phone Number",-1)),t("div",ne,[t("div",le,[e[6]||(e[6]=t("div",{class:"absolute inset-y-0 left-0 flex items-center"},[t("label",{for:"country",class:"sr-only"},"Country"),t("div",{class:"h-12 py-0 pl-3 pr-2 border-r border-gray-300 bg-gray-50 flex items-center justify-center text-gray-500 sm:text-sm"}," ðŸ‡¸ðŸ‡¦ +966 ")],-1)),v(t("input",{type:"tel",required:"","onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),class:w(["h-12 focus:ring-blue-500 focus:border-blue-500 block w-full pl-20 sm:text-sm border-gray-300 rounded-md",{"border-red-500":r(s).errors.customer_phone||b.value&&b.value.length<9}]),placeholder:"5XXXXXXXX",pattern:"[0-9]{9,10}",minlength:"9",maxlength:"10",inputmode:"numeric",onInput:U,onKeydown:e[1]||(e[1]=a=>{!/^[0-9\b]+$/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Delete"&&a.key!=="Tab"&&a.preventDefault()})},null,34),[[y,b.value]])])]),r(s).errors.customer_phone?(n(),u("p",ie,f(r(s).errors.customer_phone),1)):h("",!0)])])]),t("div",de,[t("div",ce,[t("div",ue,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Brand",-1)),v(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>r(s).vehicle_make=a),class:w(["h-12 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(s).errors.vehicle_make}]),placeholder:"Toyota"},null,2),[[y,r(s).vehicle_make]]),r(s).errors.vehicle_make?(n(),u("p",me,f(r(s).errors.vehicle_make),1)):h("",!0)]),t("div",pe,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Model",-1)),v(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=a=>r(s).vehicle_model=a),class:w(["h-12 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(s).errors.vehicle_model}]),placeholder:"Camry"},null,2),[[y,r(s).vehicle_model]]),r(s).errors.vehicle_model?(n(),u("p",ge,f(r(s).errors.vehicle_model),1)):h("",!0)]),t("div",fe,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Plate",-1)),v(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>r(s).license_plate=a),class:w(["h-12 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(s).errors.license_plate}]),placeholder:"ABC123"},null,2),[[y,r(s).license_plate]]),r(s).errors.license_plate?(n(),u("p",be,f(r(s).errors.license_plate),1)):h("",!0)])]),t("div",he,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notes",-1)),v(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>r(s).notes=a),rows:"3",class:"w-full h-28 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Any special instructions or notes about the vehicle..."},null,512),[[y,r(s).notes]]),r(s).errors.notes?(n(),u("p",ve,f(r(s).errors.notes),1)):h("",!0)]),t("div",ye,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Upload Car Images",-1)),t("div",xe,[t("div",we,[e[15]||(e[15]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true"},[t("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),t("div",ke,[t("label",_e,[e[12]||(e[12]=t("span",null,"Upload files",-1)),t("input",{id:"vehicle_images",name:"vehicle_images",type:"file",class:"sr-only",multiple:"",onChange:I,accept:"image/*"},null,32)]),e[13]||(e[13]=t("p",{class:"pl-1"},"or drag and drop",-1))]),e[16]||(e[16]=t("p",{class:"text-xs text-gray-500"},"PNG, JPG, GIF up to 10MB",-1)),l.value.length>0?(n(),u("div",Ce,[(n(!0),u(q,null,H(l.value,(a,D)=>(n(),u("div",{key:D,class:"flex items-center justify-between p-2 bg-gray-50 rounded-md"},[t("span",Te,f(a.name),1),t("button",{type:"button",onClick:Fe=>V(D),class:"text-red-600 hover:text-red-800"},[...e[14]||(e[14]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Pe)]))),128))])):h("",!0)])])])]),t("div",Le,[m(r(E),{href:o.route("tenant.dashboard"),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:p(()=>[...e[18]||(e[18]=[_(" Cancel ",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"ml-3 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:r(s).processing},[r(s).processing?(n(),u("span",Ee," Processing... ")):(n(),u("span",Ne,"Save & Create Ticket"))],8,De)])],32)])])]),m(r(W),{as:"template",show:k.value},{default:p(()=>[m(r(z),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:j},{default:p(()=>[t("div",Se,[m(r(N),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[m(r(J),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),e[23]||(e[23]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),m(r(N),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:p(()=>[t("div",Ue,[t("div",null,[t("div",je,[m(d,{class:"h-6 w-6 text-green-600","aria-hidden":"true"})]),t("div",Ie,[m(r(K),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:p(()=>[...e[21]||(e[21]=[_(" Ticket Created Successfully! ",-1)])]),_:1}),t("div",Ve,[t("p",Me," Ticket #"+f(g.value),1)])])]),t("div",Re,[t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:R}," Print Ticket "),t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:A}," Download Ticket "),m(r(E),{href:o.route("tenant.dashboard"),class:"col-span-2 mt-3 inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:text-sm text-center"},{default:p(()=>[...e[22]||(e[22]=[_(" Close & Go to Dashboard ",-1)])]),_:1},8,["href"])])])]),_:1})])]),_:1})]),_:1},8,["show"])]),_:1})}}};export{qe as default};
