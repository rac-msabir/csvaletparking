import{s as G,T as Q,r as m,x as z,C as W,c as Y,w as g,a as t,b as p,h as J,d as i,e as v,i as _,n as T,u as r,v as k,o as n,t as f,F as K,g as Z,k as M,f as E,p as ee}from"./app-B8PHipN1.js";import{S as te,Y as se,h as I,_ as oe,V as re,b as $}from"./browser-6Ox6JFG3.js";import{_ as ae}from"./AppLayout-NDgKZX1i.js";import"./ResponsiveNavLink-Bxis3xeE.js";const ne={class:"min-h-screen bg-gray-100"},le={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},ie={class:"bg-white shadow rounded-lg overflow-hidden"},de={class:"px-6 py-5"},ce={class:"grid grid-cols-6 gap-6"},ue={class:"col-span-6 sm:col-span-2"},me={class:"mt-1 flex rounded-md shadow-sm"},pe={class:"relative flex-grow"},ge={key:0,class:"mt-1 text-sm text-red-600"},fe={class:"px-6 pb-5"},be={class:"grid grid-cols-6 gap-6"},he={class:"col-span-6 sm:col-span-2"},ve={key:0,class:"mt-1 text-sm text-red-600"},ye={class:"col-span-6 sm:col-span-2"},xe={key:0,class:"mt-1 text-sm text-red-600"},we={class:"col-span-6 sm:col-span-2"},_e={key:0,class:"mt-1 text-sm text-red-600"},ke={class:"col-span-6 mt-6"},Ce={key:0,class:"mt-1 text-sm text-red-600"},Pe={class:"col-span-6 sm:col-span-2 mt-6"},Te={class:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md"},Ee={class:"space-y-1 text-center"},De={class:"flex text-sm text-gray-600"},Ne={for:"vehicle_images",class:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500"},je={key:0,class:"mt-2"},Le={class:"text-sm text-gray-700 truncate max-w-xs"},Se=["onClick"],Ve={class:"px-6 py-3 bg-gray-50 text-right border-t border-gray-200"},Me=["disabled"],Ie={key:0},$e={key:1},qe={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Ae={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6"},Be={class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"},Re={class:"mt-3 text-center sm:mt-5"},Ue={class:"mt-4"},Fe={class:"text-sm text-gray-500"},He={class:"mt-5 sm:mt-6 grid grid-cols-2 gap-3"},Oe=["disabled"],Xe={key:0,class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ge={key:1,class:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ke={__name:"Create",props:{errors:Object},setup(Qe){const{proxy:y}=G(),o=Q({customer_phone:"",vehicle_make:"",vehicle_model:"",license_plate:"",notes:"",check_in_latitude:null,check_in_longitude:null,images:[]}),d=m([]),c=m("Getting your location..."),C=m(!1),D=m(!1),N=m(null),q=m(null),P=m(""),b=m(""),h=m(""),A=()=>{const s=h.value.replace(/\D/g,"").substring(0,10);h.value=s,s.length>=9?o.customer_phone="966"+(s.startsWith("0")?s.substring(1):s):o.customer_phone=""},x=m(!1),B=()=>{D.value=!1,P.value=""},R=async()=>{var s,e,u,a,w,j;if(!b.value){y.$toast.error("No ticket number available for printing");return}x.value=!0;try{const l=route("print.qr",b.value);console.log("Sending print request to:",l);const V=await axios.get(l,{timeout:1e4,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(V.data.status==="success")y.$toast.success("Ticket sent to thermal printer successfully!");else throw new Error(V.data.message||"Failed to print ticket")}catch(l){console.error("Print error details:",{message:l.message,code:l.code,status:(s=l.response)==null?void 0:s.status,statusText:(e=l.response)==null?void 0:e.statusText,responseData:(u=l.response)==null?void 0:u.data}),l.code==="ECONNABORTED"?y.$toast.error("Print request timed out. Please check the printer connection."):((a=l.response)==null?void 0:a.status)===502?y.$toast.error("Unable to connect to the print service. Please try again later."):y.$toast.error(`Print failed: ${((j=(w=l.response)==null?void 0:w.data)==null?void 0:j.message)||l.message}`)}finally{x.value=!1}},U=s=>{const u=Array.from(s.target.files).filter(a=>a.type.startsWith("image/")).slice(0,5-d.value.length);d.value=[...d.value,...u],o.images=d.value},F=s=>{d.value.splice(s,1),o.images=[...d.value]},L=async()=>{if(!navigator.geolocation){c.value="Geolocation is not supported by your browser";return}try{c.value="Getting your location...";const s=await new Promise((e,u)=>{navigator.geolocation.getCurrentPosition(e,u,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});o.check_in_latitude=s.coords.latitude,o.check_in_longitude=s.coords.longitude,C.value=!0,c.value="Location captured successfully"}catch(s){switch(console.error("Error getting location:",s),s.code){case s.PERMISSION_DENIED:c.value="Location access was denied. Please enable location services and refresh the page.";break;case s.POSITION_UNAVAILABLE:c.value="Location information is unavailable.";break;case s.TIMEOUT:c.value="The request to get user location timed out.";break;default:c.value="An unknown error occurred while getting location."}C.value=!1}},H=async()=>{if(console.log(o),!C.value){c.value="Getting your location...";try{if(await L(),!C.value){c.value="Location is required. Please enable location services and try again.";return}}catch{c.value="Error getting location. Please try again.";return}}try{if(d.value.length>0){const s=new FormData;Object.keys(o).forEach(e=>{e!=="images"&&o[e]!==null&&s.append(e,o[e])}),d.value.forEach((e,u)=>{s.append(`images[${u}]`,e)}),await o.post(route("tenant.tickets.store"),{data:s,forceFormData:!0,preserveScroll:!0,onSuccess:e=>{e.props.ticket&&S(e.props.ticket)},onError:e=>{console.log("Form errors:",e),o.errors=e}})}else await o.post(route("tenant.tickets.store"),{preserveScroll:!0,onSuccess:s=>{s.props.ticket&&S(s.props.ticket)},onError:s=>{console.log("Form errors:",s),o.errors=s}})}catch(s){console.error("Error submitting form:",s),o.errors={submit:["An error occurred while submitting the form."]}}},S=async s=>{try{b.value=s.ticket_number;const e=JSON.stringify({ticket_id:s.id,ticket_number:s.ticket_number,customer_name:s.customer_name,license_plate:s.license_plate});P.value=await $.toDataURL(e,{errorCorrectionLevel:"H",width:200,margin:1}),D.value=!0,await ee(),N.value&&await $.toCanvas(N.value,e,{errorCorrectionLevel:"H",width:200,margin:1})}catch(e){console.error("Error generating QR code:",e)}},O=()=>{const s=window.open("","_blank"),e=`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Print Ticket #${b.value}</title>
      <style>
        @media print {
          @page { margin: 0; }
          body { margin: 1.6cm; }
        }
        .ticket { 
          max-width: 300px; 
          margin: 0 auto; 
          text-align: center; 
          padding: 20px; 
          border: 1px solid #000; 
          border-radius: 5px;
        }
        .ticket h2 { margin: 0 0 10px 0; }
        .ticket p { margin: 5px 0; }
      </style>
    </head>
    <body>
      <div class="ticket">
        <h2>Valet Parking Ticket</h2>
        <p>Ticket #${b.value}</p>
        <img src="${P.value}" alt="QR Code" style="width: 200px; height: 200px;">
        <p>${new Date().toLocaleString()}</p>
        <p>Please keep this ticket safe</p>
      </div>
      <script>
        window.onload = function() {
          window.print();
          window.onafterprint = function() {
            window.close();
          }
        };
      <\/script>
    </body>
    </html>
  `;s.document.open(),s.document.write(e),s.document.close()},X=()=>{const s=document.createElement("a");s.download=`ticket-${b.value}.png`,s.href=P.value,document.body.appendChild(s),s.click(),document.body.removeChild(s)};return z(()=>{L()}),(s,e)=>{const u=W("CheckIcon");return n(),Y(ae,null,{default:g(()=>[t("div",ne,[e[20]||(e[20]=t("div",{class:"bg-white shadow"},[t("div",{class:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center"},[t("h2",{class:"text-lg font-medium text-gray-900"},"Create New Ticket")])],-1)),t("div",le,[t("div",ie,[t("form",{id:"ticket-form",onSubmit:J(H,["prevent"]),enctype:"multipart/form-data"},[e[19]||(e[19]=t("div",{class:"px-6 py-5 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Customer Info")],-1)),t("div",de,[t("div",ce,[t("div",ue,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Customer Phone Number",-1)),t("div",me,[t("div",pe,[e[6]||(e[6]=t("div",{class:"absolute inset-y-0 left-0 flex items-center"},[t("label",{for:"country",class:"sr-only"},"Country"),t("div",{class:"h-12 py-0 pl-3 pr-2 border-r border-gray-300 bg-gray-50 flex items-center justify-center text-gray-500 sm:text-sm"}," ðŸ‡¸ðŸ‡¦ +966 ")],-1)),_(t("input",{type:"tel",required:"","onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),class:T(["h-12 focus:ring-blue-500 focus:border-blue-500 block w-full pl-20 sm:text-sm border-gray-300 rounded-md",{"border-red-500":r(o).errors.customer_phone||h.value&&h.value.length<9}]),placeholder:"5XXXXXXXX",pattern:"[0-9]{9,10}",minlength:"9",maxlength:"10",inputmode:"numeric",onInput:A,onKeydown:e[1]||(e[1]=a=>{!/^[0-9\b]+$/.test(a.key)&&a.key!=="Backspace"&&a.key!=="Delete"&&a.key!=="Tab"&&a.preventDefault()})},null,34),[[k,h.value]])])]),r(o).errors.customer_phone?(n(),i("p",ge,f(r(o).errors.customer_phone),1)):v("",!0)])])]),t("div",fe,[t("div",be,[t("div",he,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Brand",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>r(o).vehicle_make=a),class:T(["h-12 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(o).errors.vehicle_make}]),placeholder:"Toyota"},null,2),[[k,r(o).vehicle_make]]),r(o).errors.vehicle_make?(n(),i("p",ve,f(r(o).errors.vehicle_make),1)):v("",!0)]),t("div",ye,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Model",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=a=>r(o).vehicle_model=a),class:T(["h-12 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(o).errors.vehicle_model}]),placeholder:"Camry"},null,2),[[k,r(o).vehicle_model]]),r(o).errors.vehicle_model?(n(),i("p",xe,f(r(o).errors.vehicle_model),1)):v("",!0)]),t("div",we,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Plate",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>r(o).license_plate=a),class:T(["h-12 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(o).errors.license_plate}]),placeholder:"ABC123"},null,2),[[k,r(o).license_plate]]),r(o).errors.license_plate?(n(),i("p",_e,f(r(o).errors.license_plate),1)):v("",!0)])]),t("div",ke,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notes",-1)),_(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>r(o).notes=a),rows:"3",class:"w-full h-28 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Any special instructions or notes about the vehicle..."},null,512),[[k,r(o).notes]]),r(o).errors.notes?(n(),i("p",Ce,f(r(o).errors.notes),1)):v("",!0)]),t("div",Pe,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Upload Car Images",-1)),t("div",Te,[t("div",Ee,[e[15]||(e[15]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true"},[t("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),t("div",De,[t("label",Ne,[e[12]||(e[12]=t("span",null,"Upload files",-1)),t("input",{id:"vehicle_images",name:"vehicle_images",type:"file",class:"sr-only",multiple:"",onChange:U,accept:"image/*"},null,32)]),e[13]||(e[13]=t("p",{class:"pl-1"},"or drag and drop",-1))]),e[16]||(e[16]=t("p",{class:"text-xs text-gray-500"},"PNG, JPG, GIF up to 10MB",-1)),d.value.length>0?(n(),i("div",je,[(n(!0),i(K,null,Z(d.value,(a,w)=>(n(),i("div",{key:w,class:"flex items-center justify-between p-2 bg-gray-50 rounded-md"},[t("span",Le,f(a.name),1),t("button",{type:"button",onClick:j=>F(w),class:"text-red-600 hover:text-red-800"},[...e[14]||(e[14]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Se)]))),128))])):v("",!0)])])])]),t("div",Ve,[p(r(M),{href:s.route("tenant.dashboard"),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:g(()=>[...e[18]||(e[18]=[E(" Cancel ",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"ml-3 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:r(o).processing},[r(o).processing?(n(),i("span",Ie," Processing... ")):(n(),i("span",$e,"Save & Create Ticket"))],8,Me)])],32)])])]),p(r(te),{as:"template",show:D.value},{default:g(()=>[p(r(se),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:B},{default:g(()=>[t("div",qe,[p(r(I),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:g(()=>[p(r(oe),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),e[25]||(e[25]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"â€‹",-1)),p(r(I),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:g(()=>[t("div",Ae,[t("div",null,[t("div",Be,[p(u,{class:"h-6 w-6 text-green-600","aria-hidden":"true"})]),t("div",Re,[p(r(re),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:g(()=>[...e[21]||(e[21]=[E(" Ticket Created Successfully! ",-1)])]),_:1}),t("div",Ue,[t("p",Fe," Ticket #"+f(b.value),1),t("div",{class:"mt-4 flex justify-center",ref_key:"qrCodeElement",ref:q},[t("canvas",{ref_key:"qrCanvas",ref:N,class:"border border-gray-200 p-2 rounded"},null,512)],512)])])]),t("div",He,[t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:O}," Print Ticket "),t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:X}," Download QR "),t("button",{type:"button",class:"col-span-2 inline-flex justify-center w-full rounded-md border border-green-600 shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:text-sm",onClick:R,disabled:x.value},[x.value?(n(),i("svg",Xe,[...e[22]||(e[22]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(n(),i("svg",Ge,[...e[23]||(e[23]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"},null,-1)])])),E(" "+f(x.value?"Printing...":"Print via Thermal Printer"),1)],8,Oe),p(r(M),{href:s.route("tenant.dashboard"),class:"col-span-2 mt-3 inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:text-sm text-center"},{default:g(()=>[...e[24]||(e[24]=[E(" Close & Go to Dashboard ",-1)])]),_:1},8,["href"])])])]),_:1})])]),_:1})]),_:1},8,["show"])]),_:1})}}};export{Ke as default};
