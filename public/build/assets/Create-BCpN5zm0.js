import{T as O,r as m,s as $,B as G,c as Q,w as g,a as t,b as p,h as z,i as y,d as i,e as h,n as C,u as r,v as w,o as n,t as f,F as W,g as Y,k as j,f as P,p as J}from"./app-Bsz5vl9K.js";import{S as X,Y as K,h as q,_ as Z,V as ee,b as M}from"./browser-MhEtt-5y.js";import{_ as te}from"./AppLayout-BVTdRbjh.js";import"./ResponsiveNavLink-Cbi5WnfP.js";const se={class:"min-h-screen bg-gray-100"},oe={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},re={class:"bg-white shadow rounded-lg overflow-hidden"},ae={class:"px-6 py-5"},ne={class:"grid grid-cols-6 gap-6"},le={class:"col-span-6 sm:col-span-2"},ie={key:0,class:"mt-1 text-sm text-red-600"},de={class:"px-6 pb-5"},ce={class:"grid grid-cols-6 gap-6"},ue={class:"col-span-6 sm:col-span-2"},me={key:0,class:"mt-1 text-sm text-red-600"},pe={class:"col-span-6 sm:col-span-2"},ge={key:0,class:"mt-1 text-sm text-red-600"},fe={class:"col-span-6 sm:col-span-2"},be={key:0,class:"mt-1 text-sm text-red-600"},he={class:"col-span-6 mt-6"},ve={key:0,class:"mt-1 text-sm text-red-600"},xe={class:"col-span-6 sm:col-span-2 mt-6"},ye={class:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md"},we={class:"space-y-1 text-center"},_e={class:"flex text-sm text-gray-600"},ke={for:"vehicle_images",class:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500"},Ce={key:0,class:"mt-2"},Pe={class:"text-sm text-gray-700 truncate max-w-xs"},Te=["onClick"],Ee={class:"px-6 py-3 bg-gray-50 text-right border-t border-gray-200"},Ve=["disabled"],Le={key:0},Ne={key:1},Se={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},je={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6"},qe={class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"},Me={class:"mt-3 text-center sm:mt-5"},De={class:"mt-4"},Ae={class:"text-sm text-gray-500"},Be={class:"mt-5 sm:mt-6 grid grid-cols-2 gap-3"},Re=["disabled"],Fe={key:0,class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ie={key:1,class:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Qe={__name:"Create",props:{errors:Object},setup(Ue){const o=O({customer_phone:"",vehicle_make:"",vehicle_model:"",license_plate:"",notes:"",check_in_latitude:null,check_in_longitude:null,images:[]}),d=m([]),c=m("Getting your location..."),_=m(!1),T=m(!1),E=m(null),D=m(null),k=m(""),b=m(""),v=m(!1),A=()=>{T.value=!1,k.value=""},B=async()=>{var s,e,u,a,x,V;if(!b.value){toast.error("No ticket number available for printing");return}v.value=!0;try{const l=route("print.qr",b.value);console.log("Sending print request to:",l);const S=await axios.get(l,{timeout:1e4,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(S.data.status==="success")toast.success("Ticket sent to thermal printer successfully!");else throw new Error(S.data.message||"Failed to print ticket")}catch(l){console.error("Print error details:",{message:l.message,code:l.code,status:(s=l.response)==null?void 0:s.status,statusText:(e=l.response)==null?void 0:e.statusText,responseData:(u=l.response)==null?void 0:u.data}),l.code==="ECONNABORTED"?toast.error("Print request timed out. Please check the printer connection."):((a=l.response)==null?void 0:a.status)===502?toast.error("Unable to connect to the print service. Please try again later."):toast.error(`Print failed: ${((V=(x=l.response)==null?void 0:x.data)==null?void 0:V.message)||l.message}`)}finally{v.value=!1}},R=s=>{const u=Array.from(s.target.files).filter(a=>a.type.startsWith("image/")).slice(0,5-d.value.length);d.value=[...d.value,...u],o.images=d.value},F=s=>{d.value.splice(s,1),o.images=[...d.value]},L=async()=>{if(!navigator.geolocation){c.value="Geolocation is not supported by your browser";return}try{c.value="Getting your location...";const s=await new Promise((e,u)=>{navigator.geolocation.getCurrentPosition(e,u,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});o.check_in_latitude=s.coords.latitude,o.check_in_longitude=s.coords.longitude,_.value=!0,c.value="Location captured successfully"}catch(s){switch(console.error("Error getting location:",s),s.code){case s.PERMISSION_DENIED:c.value="Location access was denied. Please enable location services and refresh the page.";break;case s.POSITION_UNAVAILABLE:c.value="Location information is unavailable.";break;case s.TIMEOUT:c.value="The request to get user location timed out.";break;default:c.value="An unknown error occurred while getting location."}_.value=!1}},I=async()=>{if(console.log(o),!_.value){c.value="Getting your location...";try{if(await L(),!_.value){c.value="Location is required. Please enable location services and try again.";return}}catch{c.value="Error getting location. Please try again.";return}}try{if(d.value.length>0){const s=new FormData;Object.keys(o).forEach(e=>{e!=="images"&&o[e]!==null&&s.append(e,o[e])}),d.value.forEach((e,u)=>{s.append(`images[${u}]`,e)}),await o.post(route("tenant.tickets.store"),{data:s,forceFormData:!0,preserveScroll:!0,onSuccess:e=>{e.props.ticket&&N(e.props.ticket)},onError:e=>{console.log("Form errors:",e),o.errors=e}})}else await o.post(route("tenant.tickets.store"),{preserveScroll:!0,onSuccess:s=>{s.props.ticket&&N(s.props.ticket)},onError:s=>{console.log("Form errors:",s),o.errors=s}})}catch(s){console.error("Error submitting form:",s),o.errors={submit:["An error occurred while submitting the form."]}}},N=async s=>{try{b.value=s.ticket_number;const e=JSON.stringify({ticket_id:s.id,ticket_number:s.ticket_number,customer_name:s.customer_name,license_plate:s.license_plate});k.value=await M.toDataURL(e,{errorCorrectionLevel:"H",width:200,margin:1}),T.value=!0,await J(),E.value&&await M.toCanvas(E.value,e,{errorCorrectionLevel:"H",width:200,margin:1})}catch(e){console.error("Error generating QR code:",e)}},U=()=>{const s=window.open("","_blank"),e=`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Print Ticket #${b.value}</title>
      <style>
        @media print {
          @page { margin: 0; }
          body { margin: 1.6cm; }
        }
        .ticket { 
          max-width: 300px; 
          margin: 0 auto; 
          text-align: center; 
          padding: 20px; 
          border: 1px solid #000; 
          border-radius: 5px;
        }
        .ticket h2 { margin: 0 0 10px 0; }
        .ticket p { margin: 5px 0; }
      </style>
    </head>
    <body>
      <div class="ticket">
        <h2>Valet Parking Ticket</h2>
        <p>Ticket #${b.value}</p>
        <img src="${k.value}" alt="QR Code" style="width: 200px; height: 200px;">
        <p>${new Date().toLocaleString()}</p>
        <p>Please keep this ticket safe</p>
      </div>
      <script>
        window.onload = function() {
          window.print();
          window.onafterprint = function() {
            window.close();
          }
        };
      <\/script>
    </body>
    </html>
  `;s.document.open(),s.document.write(e),s.document.close()},H=()=>{const s=document.createElement("a");s.download=`ticket-${b.value}.png`,s.href=k.value,document.body.appendChild(s),s.click(),document.body.removeChild(s)};return $(()=>{L()}),(s,e)=>{const u=G("CheckIcon");return n(),Q(te,null,{default:g(()=>[t("div",se,[e[18]||(e[18]=t("div",{class:"bg-white shadow"},[t("div",{class:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center"},[t("h2",{class:"text-lg font-medium text-gray-900"},"Create New Ticket")])],-1)),t("div",oe,[t("div",re,[t("form",{id:"ticket-form",onSubmit:z(I,["prevent"]),enctype:"multipart/form-data"},[e[17]||(e[17]=t("div",{class:"px-6 py-5 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Customer Info")],-1)),t("div",ae,[t("div",ne,[t("div",le,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Customer Phone Number ",-1)),y(t("input",{type:"tel","onUpdate:modelValue":e[0]||(e[0]=a=>r(o).customer_phone=a),class:C(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(o).errors.customer_phone}]),placeholder:"+1 (555) 123-4567"},null,2),[[w,r(o).customer_phone]]),r(o).errors.customer_phone?(n(),i("p",ie,f(r(o).errors.customer_phone),1)):h("",!0)])])]),t("div",de,[t("div",ce,[t("div",ue,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Brand",-1)),y(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>r(o).vehicle_make=a),class:C(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(o).errors.vehicle_make}]),placeholder:"Toyota",required:""},null,2),[[w,r(o).vehicle_make]]),r(o).errors.vehicle_make?(n(),i("p",me,f(r(o).errors.vehicle_make),1)):h("",!0)]),t("div",pe,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Model",-1)),y(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>r(o).vehicle_model=a),class:C(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(o).errors.vehicle_model}]),placeholder:"Camry",required:""},null,2),[[w,r(o).vehicle_model]]),r(o).errors.vehicle_model?(n(),i("p",ge,f(r(o).errors.vehicle_model),1)):h("",!0)]),t("div",fe,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Car Plate",-1)),y(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=a=>r(o).license_plate=a),class:C(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":r(o).errors.license_plate}]),placeholder:"ABC123",required:""},null,2),[[w,r(o).license_plate]]),r(o).errors.license_plate?(n(),i("p",be,f(r(o).errors.license_plate),1)):h("",!0)])]),t("div",he,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notes",-1)),y(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>r(o).notes=a),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Any special instructions or notes about the vehicle..."},null,512),[[w,r(o).notes]]),r(o).errors.notes?(n(),i("p",ve,f(r(o).errors.notes),1)):h("",!0)]),t("div",xe,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Vehicle Images",-1)),t("div",ye,[t("div",we,[e[13]||(e[13]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true"},[t("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),t("div",_e,[t("label",ke,[e[10]||(e[10]=t("span",null,"Upload files",-1)),t("input",{id:"vehicle_images",name:"vehicle_images",type:"file",class:"sr-only",multiple:"",onChange:R,accept:"image/*"},null,32)]),e[11]||(e[11]=t("p",{class:"pl-1"},"or drag and drop",-1))]),e[14]||(e[14]=t("p",{class:"text-xs text-gray-500"},"PNG, JPG, GIF up to 10MB",-1)),d.value.length>0?(n(),i("div",Ce,[(n(!0),i(W,null,Y(d.value,(a,x)=>(n(),i("div",{key:x,class:"flex items-center justify-between p-2 bg-gray-50 rounded-md"},[t("span",Pe,f(a.name),1),t("button",{type:"button",onClick:V=>F(x),class:"text-red-600 hover:text-red-800"},[...e[12]||(e[12]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Te)]))),128))])):h("",!0)])])])]),t("div",Ee,[p(r(j),{href:s.route("tenant.dashboard"),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:g(()=>[...e[16]||(e[16]=[P(" Cancel ",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"ml-3 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:r(o).processing},[r(o).processing?(n(),i("span",Le," Processing... ")):(n(),i("span",Ne,"Save & Create Ticket"))],8,Ve)])],32)])])]),p(r(X),{as:"template",show:T.value},{default:g(()=>[p(r(K),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:A},{default:g(()=>[t("div",Se,[p(r(q),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:g(()=>[p(r(Z),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),e[23]||(e[23]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),p(r(q),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:g(()=>[t("div",je,[t("div",null,[t("div",qe,[p(u,{class:"h-6 w-6 text-green-600","aria-hidden":"true"})]),t("div",Me,[p(r(ee),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:g(()=>[...e[19]||(e[19]=[P(" Ticket Created Successfully! ",-1)])]),_:1}),t("div",De,[t("p",Ae," Ticket #"+f(b.value),1),t("div",{class:"mt-4 flex justify-center",ref_key:"qrCodeElement",ref:D},[t("canvas",{ref_key:"qrCanvas",ref:E,class:"border border-gray-200 p-2 rounded"},null,512)],512)])])]),t("div",Be,[t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:U}," Print Ticket "),t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:H}," Download QR "),t("button",{type:"button",class:"col-span-2 inline-flex justify-center w-full rounded-md border border-green-600 shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:text-sm",onClick:B,disabled:v.value},[v.value?(n(),i("svg",Fe,[...e[20]||(e[20]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(n(),i("svg",Ie,[...e[21]||(e[21]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"},null,-1)])])),P(" "+f(v.value?"Printing...":"Print via Thermal Printer"),1)],8,Re),p(r(j),{href:s.route("tenant.dashboard"),class:"col-span-2 mt-3 inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:text-sm text-center"},{default:g(()=>[...e[22]||(e[22]=[P(" Close & Go to Dashboard ",-1)])]),_:1},8,["href"])])])]),_:1})])]),_:1})]),_:1},8,["show"])]),_:1})}}};export{Qe as default};
