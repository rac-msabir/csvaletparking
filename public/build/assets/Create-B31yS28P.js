import{T as N,r as b,s as U,B as A,c as L,w as g,a as t,b as c,h as R,i as m,d as n,e as u,n as f,u as o,v as p,o as a,t as d,k as S,f as k,p as j}from"./app-CKE6240-.js";import{S as O,Y as M,h as T,_ as B,V as Q,b as $}from"./browser-BxF3Usl0.js";import{_ as G}from"./AppLayout-BnUZnm6l.js";import"./ResponsiveNavLink-C8zca6pu.js";const J={class:"min-h-screen bg-gray-100"},Y={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},z={class:"bg-white shadow rounded-lg overflow-hidden"},F={class:"px-6 py-5"},H={class:"grid grid-cols-6 gap-6"},W={class:"col-span-6 sm:col-span-2"},K={key:0,class:"mt-1 text-sm text-red-600"},X={class:"col-span-6 sm:col-span-2"},Z={key:0,class:"mt-1 text-sm text-red-600"},ee={class:"col-span-6 sm:col-span-2"},te={key:0,class:"mt-1 text-sm text-red-600"},oe={class:"px-6 pb-5"},se={class:"grid grid-cols-6 gap-6"},re={class:"col-span-6 sm:col-span-2"},le={key:0,class:"mt-1 text-sm text-red-600"},ae={class:"col-span-6 sm:col-span-2"},ne={key:0,class:"mt-1 text-sm text-red-600"},ie={class:"col-span-6 sm:col-span-2"},de={key:0,class:"mt-1 text-sm text-red-600"},ce={class:"col-span-6 sm:col-span-2"},me={key:0,class:"mt-1 text-sm text-red-600"},ue={class:"col-span-6 sm:col-span-2"},pe={key:0,class:"mt-1 text-sm text-red-600"},ge={class:"px-6 pb-5 bg-gray-50"},be={class:"grid grid-cols-6 gap-6"},fe={class:"col-span-6"},xe={key:0,class:"mt-1 text-sm text-red-600"},ye={class:"px-6 py-3 bg-gray-50 text-right border-t border-gray-200"},he=["disabled"],ve={key:0},_e={key:1},we={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ke={class:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6"},Ce={class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100"},Ee={class:"mt-3 text-center sm:mt-5"},Se={class:"mt-4"},Te={class:"text-sm text-gray-500"},Ve={class:"mt-5 sm:mt-6 grid grid-cols-2 gap-3"},Ue={__name:"Create",props:{errors:Object},setup(Pe){const s=N({customer_name:"",customer_phone:"",customer_email:"",vehicle_make:"",vehicle_model:"",vehicle_color:"",license_plate:"",parking_spot:"",notes:"",check_in_latitude:null,check_in_longitude:null}),i=b("Getting your location..."),v=b(!1),w=b(!1),_=b(""),x=b(null),V=b(null),y=b("");U(()=>{C()});async function C(){if(!navigator.geolocation){i.value="Geolocation is not supported by your browser";return}try{i.value="Getting your location...";const r=await new Promise((e,h)=>{navigator.geolocation.getCurrentPosition(e,h,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})});s.check_in_latitude=r.coords.latitude,s.check_in_longitude=r.coords.longitude,v.value=!0,i.value="Location captured successfully"}catch(r){switch(console.error("Error getting location:",r),r.code){case r.PERMISSION_DENIED:i.value="Location access was denied. Please enable location services and refresh the page.";break;case r.POSITION_UNAVAILABLE:i.value="Location information is unavailable.";break;case r.TIMEOUT:i.value="The request to get user location timed out.";break;default:i.value="An unknown error occurred while getting location."}v.value=!1}}const E=async r=>{try{const e={id:r.id,ticket_number:r.ticket_number,customer_name:r.customer_name,vehicle_make:r.vehicle_make,vehicle_model:r.vehicle_model,vehicle_color:r.vehicle_color,license_plate:r.license_plate,parking_spot:r.parking_spot,notes:r.notes,created_at:new Date().toISOString()};if(_.value=await $.toDataURL(JSON.stringify(e),{width:200,margin:2,color:{dark:"#000000",light:"#ffffff"}}),y.value=r.ticket_number,w.value=!0,await j(),x.value){const h=x.value.getContext("2d"),l=new Image;l.src=_.value,await new Promise(D=>{l.onload=()=>{x.value.width=l.width,x.value.height=l.height,h.drawImage(l,0,0),D()}})}}catch(e){console.error("Error generating QR code:",e)}},P=()=>{const r=window.open("","_blank"),e=`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Print Ticket #${y.value}</title>
      <style>
        @media print {
          @page { margin: 0; }
          body { margin: 1.6cm; }
        }
        .ticket { 
          max-width: 300px; 
          margin: 0 auto; 
          text-align: center; 
          padding: 20px; 
          border: 1px solid #000; 
          border-radius: 5px;
        }
        .ticket h2 { margin: 0 0 10px 0; }
        .ticket p { margin: 5px 0; }
      </style>
    </head>
    <body>
      <div class="ticket">
        <h2>Valet Parking Ticket</h2>
        <p>Ticket #${y.value}</p>
        <img src="${_.value}" alt="QR Code" style="width: 200px; height: 200px;">
        <p>${new Date().toLocaleString()}</p>
        <p>Please keep this ticket safe</p>
      </div>
      <script>
        window.onload = function() {
          window.print();
          window.onafterprint = function() {
            window.close();
          }
        };
      <\/script>
    </body>
    </html>
  `;r.document.open(),r.document.write(e),r.document.close()},I=()=>{const r=document.createElement("a");r.download=`ticket-${y.value}.png`,r.href=_.value,document.body.appendChild(r),r.click(),document.body.removeChild(r)},q=async()=>{if(!v.value){i.value="Getting your location...";try{if(await C(),!v.value){i.value="Location is required. Please enable location services and try again.";return}}catch{i.value="Error getting location. Please try again.";return}}try{await s.post(route("employee.tickets.store"),{preserveScroll:!0,onSuccess:r=>{if(r.props.ticket)E(r.props.ticket);else if(r.data)try{const e=typeof r.data=="string"?JSON.parse(r.data):r.data;e.ticket&&E(e.ticket)}catch(e){console.error("Error parsing response:",e),s.errors={submit:["Error processing the ticket."]}}},onError:r=>{console.log("Form errors:",r),s.errors=r}})}catch(r){console.error("Error submitting form:",r),s.errors={submit:["An error occurred while submitting the form."]}}};return(r,e)=>{const h=A("CheckIcon");return a(),L(G,null,{default:g(()=>[t("div",J,[e[23]||(e[23]=t("div",{class:"bg-white shadow"},[t("div",{class:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center"},[t("h2",{class:"text-lg font-medium text-gray-900"},"Create New Ticket")])],-1)),t("div",Y,[t("div",z,[t("form",{id:"ticket-form",onSubmit:R(q,["prevent"])},[e[20]||(e[20]=t("div",{class:"px-6 py-5 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Customer Information"),t("p",{class:"mt-1 text-sm text-gray-500"},"Customer details for this ticket.")],-1)),t("div",F,[t("div",H,[t("div",W,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Name *",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>o(s).customer_name=l),class:f(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":o(s).errors.customer_name}]),placeholder:"John Doe",required:""},null,2),[[p,o(s).customer_name]]),o(s).errors.customer_name?(a(),n("p",K,d(o(s).errors.customer_name),1)):u("",!0)]),t("div",X,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Phone *",-1)),m(t("input",{type:"tel","onUpdate:modelValue":e[1]||(e[1]=l=>o(s).customer_phone=l),class:f(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":o(s).errors.customer_phone}]),placeholder:"+1 (555) 123-4567",required:""},null,2),[[p,o(s).customer_phone]]),o(s).errors.customer_phone?(a(),n("p",Z,d(o(s).errors.customer_phone),1)):u("",!0)]),t("div",ee,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),m(t("input",{type:"email","onUpdate:modelValue":e[2]||(e[2]=l=>o(s).customer_email=l),class:f(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":o(s).errors.customer_email}]),placeholder:"john@example.com"},null,2),[[p,o(s).customer_email]]),o(s).errors.customer_email?(a(),n("p",te,d(o(s).errors.customer_email),1)):u("",!0)])])]),e[21]||(e[21]=t("div",{class:"px-6 py-5 border-t border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Vehicle Information"),t("p",{class:"mt-1 text-sm text-gray-500"},"Details about the customer's vehicle.")],-1)),t("div",oe,[t("div",se,[t("div",re,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Make *",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>o(s).vehicle_make=l),class:f(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":o(s).errors.vehicle_make}]),placeholder:"Toyota",required:""},null,2),[[p,o(s).vehicle_make]]),o(s).errors.vehicle_make?(a(),n("p",le,d(o(s).errors.vehicle_make),1)):u("",!0)]),t("div",ae,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Model *",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>o(s).vehicle_model=l),class:f(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":o(s).errors.vehicle_model}]),placeholder:"Camry",required:""},null,2),[[p,o(s).vehicle_model]]),o(s).errors.vehicle_model?(a(),n("p",ne,d(o(s).errors.vehicle_model),1)):u("",!0)]),t("div",ie,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Color *",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=l=>o(s).vehicle_color=l),class:f(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":o(s).errors.vehicle_color}]),placeholder:"Red",required:""},null,2),[[p,o(s).vehicle_color]]),o(s).errors.vehicle_color?(a(),n("p",de,d(o(s).errors.vehicle_color),1)):u("",!0)]),t("div",ce,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"License Plate *",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=l=>o(s).license_plate=l),class:f(["w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",{"border-red-500":o(s).errors.license_plate}]),placeholder:"ABC123",required:""},null,2),[[p,o(s).license_plate]]),o(s).errors.license_plate?(a(),n("p",me,d(o(s).errors.license_plate),1)):u("",!0)]),t("div",ue,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Parking Spot",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=l=>o(s).parking_spot=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"A12"},null,512),[[p,o(s).parking_spot]]),o(s).errors.parking_spot?(a(),n("p",pe,d(o(s).errors.parking_spot),1)):u("",!0)])])]),e[22]||(e[22]=t("div",{class:"px-6 py-5 border-t border-gray-200 bg-gray-50"},[t("h3",{class:"text-lg font-medium text-gray-900"},"Additional Information"),t("p",{class:"mt-1 text-sm text-gray-500"},"Any special instructions or notes.")],-1)),t("div",ge,[t("div",be,[t("div",fe,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Notes",-1)),m(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>o(s).notes=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Any special instructions or notes about the vehicle..."},null,512),[[p,o(s).notes]]),o(s).errors.notes?(a(),n("p",xe,d(o(s).errors.notes),1)):u("",!0)])])]),t("div",ye,[c(o(S),{href:r.route("employee.dashboard"),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:g(()=>[...e[19]||(e[19]=[k(" Cancel ",-1)])]),_:1},8,["href"]),t("button",{type:"submit",class:"ml-3 px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:o(s).processing},[o(s).processing?(a(),n("span",ve," Processing... ")):(a(),n("span",_e,"Save & Create Ticket"))],8,he)])],32)])])]),c(o(O),{as:"template",show:w.value},{default:g(()=>[c(o(M),{as:"div",class:"fixed z-10 inset-0 overflow-y-auto",onClose:e[9]||(e[9]=l=>w.value=!1)},{default:g(()=>[t("div",we,[c(o(T),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:g(()=>[c(o(B),{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"})]),_:1}),e[26]||(e[26]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),c(o(T),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:g(()=>[t("div",ke,[t("div",null,[t("div",Ce,[c(h,{class:"h-6 w-6 text-green-600","aria-hidden":"true"})]),t("div",Ee,[c(o(Q),{as:"h3",class:"text-lg leading-6 font-medium text-gray-900"},{default:g(()=>[...e[24]||(e[24]=[k(" Ticket Created Successfully! ",-1)])]),_:1}),t("div",Se,[t("p",Te," Ticket #"+d(y.value),1),t("div",{class:"mt-4 flex justify-center",ref_key:"qrCodeElement",ref:V},[t("canvas",{ref_key:"qrCanvas",ref:x,class:"border border-gray-200 p-2 rounded"},null,512)],512)])])]),t("div",Ve,[t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:P}," Print Ticket "),t("button",{type:"button",class:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm",onClick:I}," Download QR "),c(o(S),{href:r.route("employee.dashboard"),class:"col-span-2 mt-3 inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:text-sm text-center"},{default:g(()=>[...e[25]||(e[25]=[k(" Close & Go to Dashboard ",-1)])]),_:1},8,["href"])])])]),_:1})])]),_:1})]),_:1},8,["show"])]),_:1})}}};export{Ue as default};
